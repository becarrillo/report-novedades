<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <title>Novedades sobre REPORTEC</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="data:image/jpeg;base64,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">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body class="mat-typography">
  <app-root id="root"></app-root>
  <script type="text/javascript">
    // TODO(developer): Set to client ID and API key from the Developer Console
    const CLIENT_ID = '13156568136-f0agm9bifksc6jt6vs8kdku1elh4af4l.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDoKbViruoPKU1qDbPwDyRgUXjLEW38ZNI';

    // Discovery doc URL for APIs used by the quickstart
    const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';

    // Authorization scopes required by the API; multiple scopes can be
    // included, separated by spaces.
    const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
    let tokenClient;

    /**
     * Callback after api.js is loaded.
     */
    function gapiLoaded() {
      gapi.load('client', initializeGapiClient);
    }

    /**
     * Callback after the API client is loaded. Loads the
     * discovery doc to initialize the API.
     */
    async function initializeGapiClient() {
      await gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: [DISCOVERY_DOC],
      });
      if (
        window.localStorage.getItem('token')!==null && 
        window.localStorage.getItem('token').length>0
      ) {
        gapi.client.setToken({"access_token": window.localStorage.getItem('token'), "token_type": "Bearer", "expires_in": window.localStorage.getItem('exp'), "scope": SCOPES});
      }
    }

    /**
     * Callback after Google Identity Services are loaded.
     */
    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: '', // defined later
      });
      setInterval(() => { // Each 10 secs send a request to get the current data
        listNovedades().then(n => {
          window.localStorage.setItem('data', JSON.stringify(n));
        })
      }, 10000);
    }

    /**
     *  Sign in the user upon button click.
     */
    function handleAuthClick() {
      tokenClient.callback = async (resp) => {
        if (resp.error !== undefined) {
          throw resp;
        }
        
        if (resp.access_token !== null && validateToken(resp.access_token)) {
          window.localStorage.setItem('token', gapi.client.getToken().access_token);
          window.localStorage.setItem('exp', gapi.client.getToken().expires_in);
          window.localStorage.setItem("data", JSON.stringify(await listNovedades()));
          window.location.pathname = '/dashboard';
        } else window.location.reload();
      };
      
      if (gapi.client.getToken() === null) {
        // Prompt the user to select a Google Account and ask for consent to share their data
        // when establishing a new session.
        tokenClient.requestAccessToken({ prompt: 'consent' });
      }
    }

    /**
     *  Sign out the user upon button click.
     */
    function handleSignoutClick() {
      var token;
      token = gapi.client.getToken();
      console.log(token, " is my TOOOOKENnN!");
      if (token['access_token']!==null && token['access_token'].length>0) {
        google.accounts.oauth2.revoke(token['access_token']);
        gapi.client.setToken({"access_token": ''});
        window.localStorage.removeItem('data');
        window.localStorage.setItem('token', '');
      }
      window.location.pathname!=='/login' ?
        window.location.pathname = '/login' : window.location.reload();
    }

    /**
     * Print the names and majors of students in a sample spreadsheet:
     * https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit
     */
    async function listNovedades() {
      let response;
      try {
        // Fetch files
        response = await gapi.client.sheets.spreadsheets.values.get({
          spreadsheetId: '149NBckRNyvdqbr-nsUmxZHZi2uw6xfwLtrdjLKN6W0w',
          range: 'NOVEDADES SEGUIMIENTO EN LINEA!A2:N',
        });
      } catch (err) {
        console.error(err.message);
        return;
      }
      const RANGE = response.result;
      if (!RANGE || !RANGE.values || RANGE.values.length == 0) {
        console.warn('No values found.');
        return;
      }

      let data;
      data = RANGE.values.map((row) => {
        return {
          "cedulaTec1": row.at(3),
          "cedulaTec2": row.at(5),
          "direccionFinal": row.at(10),
          "direccionInicial": row.at(8),
          "direccionReportec": row.at(7),
          "fecha": row.at(1),
          "horaFinDesplazamiento": row.at(11),
          "horaInicioDesplazamiento": row.at(9),
          "nombreTec1": row.at(4),
          "nombreTec2": row.at(6),
          "observaciones": row.at(13),
          "placa": row.at(2),
          "tiempoEstacionamiento": row.at(12),
          "tipo": row.at(0)
        }
      });

      return data;
    }

    function validateToken(tokenToValidate) {
      return gapi.client.getToken().access_token === tokenToValidate;
    }
  </script>
  <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
  <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</body>

</html>